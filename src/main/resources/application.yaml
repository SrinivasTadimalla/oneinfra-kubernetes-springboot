spring:
  application:
    name: kubernetes

  # ============================================================
  # ✅ JVM SSL TRUSTSTORE (outbound HTTPS from Spring)
  # Spring will call Keycloak discovery/JWKS over HTTPS.
  # ============================================================
  main:
    system-properties:
      javax.net.ssl.trustStore: ${JVM_TRUSTSTORE:/home/srinivas/pki/truststores/srinivas-trust-store.p12}
      javax.net.ssl.trustStorePassword: ${JVM_TRUSTSTORE_PASSWORD:Srikar@1}
      javax.net.ssl.trustStoreType: ${JVM_TRUSTSTORE_TYPE:PKCS12}

  # ============================================================
  # ✅ Spring Security - Resource Server (JWT)
  # ============================================================
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: https://192.168.66.1:9443/realms/oneinfra-realm
          # If issuer-uri ever gives trouble, you can switch to:
          # jwk-set-uri: https://192.168.66.1:9443/realms/oneinfra-realm/protocol/openid-connect/certs

  # ============================================================
  # Web / CORS (Angular Micro Frontends)
  # ============================================================
  web:
    cors:
      enabled: true
      configurations:
        default:
          allowed-origins:
            - "http://localhost:4200"
            - "http://192.168.66.108:4200"
            - "http://192.168.66.115:4200"
          allowed-methods:
            - GET
            - POST
            - PUT
            - PATCH
            - DELETE
            - OPTIONS
          allowed-headers:
            - "*"
          allow-credentials: true

  # ============================================================
  # PostgreSQL DataSource
  # Schema: iaas_kubernetes
  # ============================================================
  datasource:
    url: jdbc:postgresql://${DB_HOST:192.168.66.1}:5432/${DB_NAME:postgres}?currentSchema=${DB_SCHEMA:iaas_kubernetes}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:db2@dmin}
    driver-class-name: org.postgresql.Driver

  # ============================================================
  # JPA / Hibernate
  # ============================================================
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: true

  # ============================================================
  # Disable automatic SQL init
  # ============================================================
  sql:
    init:
      mode: never

# ============================================================
# ✅ Your custom app properties (NO hardcoding in Java)
# ============================================================
oneinfra:
  security:
    keycloak:
      client-id: ${KEYCLOAK_CLIENT_ID:kubernetes-backend-auth}

# ============================================================
# Server (HTTPS enabled)
# ============================================================
server:
  port: 9009
  ssl:
    enabled: true
    key-store: ${K8S_BACKEND_KEYSTORE:/home/srinivas/pki/kubernetes-backend-api/k8s-backend-keystore.p12}
    key-store-password: ${K8S_BACKEND_KEYSTORE_PASSWORD:Srikar@1}
    key-store-type: ${K8S_BACKEND_KEYSTORE_TYPE:PKCS12}
    key-alias: ${K8S_BACKEND_KEY_ALIAS:k8s-backend}

# ============================================================
# Swagger / OpenAPI (springdoc)
# ============================================================
springdoc:
  api-docs:
    enabled: true
    path: /v3/api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha
    display-request-duration: true
  default-consumes-media-type: application/json
  default-produces-media-type: application/json

# ============================================================
# Custom OneInfra properties
# ============================================================
exec:
  timeout-seconds: 120

# ============================================================
# Logging
# ============================================================
logging:
  level:
    root: INFO
    org.springframework.web: INFO
    org.hibernate.SQL: DEBUG
